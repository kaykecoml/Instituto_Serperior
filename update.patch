diff --git a/creation.html b/creation.html
index 06ce4ae890ee46be5c96ffe42af63b6cc8700618..71fc4cea067d31fbc06d0b354f1506f63d97caef 100644
--- a/creation.html
+++ b/creation.html
@@ -1,172 +1,228 @@
 <!DOCTYPE html>
 <html lang="pt-br">
 <head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Criação Pokémon</title>
   <link rel="stylesheet" href="css/pokemon.css">
   <link rel="stylesheet" href="css/creation.css">
   <link rel="icon" href="assets/logo.png">
+  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script type="module" src="js/creation.js"></script>
 </head>
 <body>
   <aside id="sideMenu" class="side-menu" aria-hidden="true">
     <div class="side-menu-header">Menu</div>
     <div class="side-menu-divider"></div>
     <div class="side-menu-actions top">
       <a class="side-menu-btn" href="pokemon.html">Pokedex</a>
       <a class="side-menu-btn" href="moves.html">Lista de golpes</a>
       <a class="side-menu-btn" href="creation.html">Criação</a>
       <a class="side-menu-btn" href="favoritos.html">Favorito</a>
     </div>
     <button class="side-menu-btn side-menu-login" type="button">Logar</button>
   </aside>
   <div id="sideMenuBackdrop" class="side-menu-backdrop hidden"></div>
 
   <header>
     <button id="logoMenuBtn" class="logo-button" type="button" aria-label="Abrir menu lateral">
       <img src="assets/logo.png" class="logo" alt="Instituo Serperior">
     </button>
     <div class="title-container">
       <h1><a href="index.html" class="site-home-link">Instituo Serperior</a></h1>
       <h2>Criação</h2>
     </div>
   </header>
 
+  <div class="mobile-tabs" role="tablist" aria-label="Seções mobile">
+    <button class="mobile-tab-btn active" type="button" data-mobile-tab-target="detalhes">Detalhes</button>
+    <button class="mobile-tab-btn" type="button" data-mobile-tab-target="golpes">Golpes</button>
+    <button class="mobile-tab-btn" type="button" data-mobile-tab-target="atributos">Atributos</button>
+    <button class="mobile-tab-btn" type="button" data-mobile-tab-target="ficha">Ficha</button>
+    <button class="mobile-tab-btn" type="button" data-mobile-tab-target="radars">Radars</button>
+  </div>
+
   <main class="creation-layout">
     <section class="builder-panel">
       <div class="mode-switch" role="tablist" aria-label="Modo de criação">
         <button class="mode-btn active" data-mode="wild" type="button">Pokémon Selvagem</button>
         <button class="mode-btn" data-mode="trained" type="button">Pokémon Adestrado</button>
         <button class="mode-btn" data-mode="quick" type="button">Geração Rápida</button>
       </div>
 
-      <div class="builder-block search-block">
+      <div class="builder-block search-block" data-mobile-tab="detalhes">
         <h3>Espécie</h3>
         <div class="search-controls">
-          <input id="speciesSearch" type="text" placeholder="Nome ou ID do Pokémon">
+          <input id="speciesSearch" type="text" placeholder="Nome ou ID do Pokémon" autocomplete="off">
           <button id="speciesSearchBtn" type="button">Buscar</button>
         </div>
         <div id="speciesPreview" class="search-preview"></div>
       </div>
 
-      <div class="builder-block" id="basicControls" hidden>
-        <h3>Configuração básica</h3>
-        <label>Gênero
-          <select id="genderSelect"></select>
-        </label>
-        <label class="inline-toggle"><input id="shinyToggle" type="checkbox"> Shiny</label>
-        <label>Nível
-          <input id="levelInput" type="number" min="1" max="100" value="5">
-        </label>
-        <div class="ability-grid">
-          <label>Habilidade 1
-            <select id="ability1"></select>
+      <div id="trainedControls" class="builder-block mode-only" data-mode-only="trained" data-mobile-tab="detalhes" hidden>
+        <h3>Regras de Adestrado</h3>
+        <div class="compact-two-grid">
+          <label>Apelido (opcional)
+            <input id="nicknameInput" type="text" maxlength="30" placeholder="Ex.: Tempestade">
           </label>
-          <label id="ability2Wrap">Habilidade 2
-            <select id="ability2"></select>
+          <label>Lealdade (0 a 4)
+            <input id="loyaltyInput" type="number" min="0" max="4" value="0">
           </label>
         </div>
-        <label>Natureza
-          <select id="natureSelect"></select>
-        </label>
       </div>
 
-      <div id="trainedControls" class="builder-block mode-only" data-mode-only="trained" hidden>
-        <h3>Regras de Adestrado</h3>
-        <label>Apelido (opcional)
-          <input id="nicknameInput" type="text" maxlength="30" placeholder="Ex.: Tempestade">
-        </label>
-        <label>Lealdade (0 a 4)
-          <input id="loyaltyInput" type="number" min="0" max="4" value="0">
+      <div class="builder-block" id="basicControls" data-mobile-tab="detalhes" hidden>
+        <h3>Detalhes</h3>
+        <div class="details-header-row">
+          <label class="compact-level">Nível
+            <input id="levelInput" type="number" min="1" max="100" value="5">
+          </label>
+          <div class="abilities-launcher">
+            <span>Habilidades</span>
+            <button id="openAbilitiesModalBtn" type="button">Selecionar habilidades</button>
+            <small id="abilitiesSummary"></small>
+          </div>
+        </div>
+
+        <div id="genderButtons" class="icon-toggle-row" aria-label="Gênero"></div>
+
+        <div class="icon-toggle-row">
+          <button id="shinyToggle" class="icon-toggle" type="button" aria-pressed="false" title="Shiny">
+            <img src="assets/forms/shiny.png" alt="Shiny">
+            <span>Shiny</span>
+          </button>
+          <button id="alphaToggle" class="icon-toggle" type="button" aria-pressed="false" title="Alpha">
+            <img src="assets/icons/alpha.png" alt="Alpha">
+            <span>Alpha</span>
+          </button>
+        </div>
+
+        <label>Natureza
+          <select id="natureSelect"></select>
         </label>
       </div>
 
-      <div id="wildControls" class="builder-block mode-only" data-mode-only="wild" hidden>
+      <div id="wildControls" class="builder-block mode-only" data-mode-only="wild" data-mobile-tab="detalhes" hidden>
         <h3>Regras de Selvagem</h3>
-        <label class="inline-toggle"><input id="alphaToggle" type="checkbox"> Alpha</label>
         <p class="helper-text">Distribuição automática por relação basal.</p>
       </div>
 
-      <div id="quickControls" class="builder-block mode-only" data-mode-only="quick" hidden>
+      <div id="quickControls" class="builder-block mode-only" data-mode-only="quick" data-mobile-tab="detalhes" hidden>
         <h3>Geração Rápida</h3>
         <button id="quickGenerateBtn" type="button">Gerar configuração aleatória</button>
       </div>
 
-      <div class="builder-block moves-selectors" id="movesSection" hidden>
+      <div class="builder-block moves-selectors" id="movesSection" data-mobile-tab="golpes" hidden>
         <h3>Golpes</h3>
         <div class="move-builder-grid">
           <div>
             <h4>Level Moves (máx. 4)</h4>
             <div class="inline-row">
               <select id="levelMoveSelect"></select>
               <button id="addLevelMoveBtn" type="button">Adicionar</button>
             </div>
             <ul id="levelMoveSlots" class="move-slots"></ul>
           </div>
           <div>
             <h4>TM / Tutor / Egg (máx. 4)</h4>
             <div class="inline-row">
               <select id="tmMoveSelect"></select>
               <button id="addTmMoveBtn" type="button">Adicionar</button>
             </div>
             <ul id="tmMoveSlots" class="move-slots"></ul>
           </div>
         </div>
       </div>
     </section>
 
-    <section class="sheet-panel">
+    <section class="sheet-panel" data-mobile-tab="ficha">
       <h3>Ficha</h3>
       <div id="sheetEmpty">Selecione um Pokémon para começar.</div>
       <div id="sheetContent" hidden>
         <div class="sheet-head">
           <img id="sheetSprite" alt="Pokémon selecionado">
           <div>
             <strong id="sheetName"></strong>
             <p id="sheetMeta"></p>
             <p id="sheetModeLabel"></p>
+            <p id="sheetLoyalty"></p>
           </div>
+          <button id="sheetCryBtn" class="cry-mini" type="button">Choro</button>
+        </div>
+
+        <div class="sheet-info-grid">
+          <div><strong>Tipos:</strong> <span id="sheetTypes"></span></div>
+          <div><strong>Proporções:</strong> <span id="sheetSize"></span></div>
+          <div><strong>Grupo reprodutor:</strong> <span id="sheetEggGroups"></span></div>
+        </div>
+
+        <div class="type-relations">
+          <div><h4>Fraquezas</h4><div id="weaknesses" class="icon-list"></div></div>
+          <div><h4>Resistências</h4><div id="resistances" class="icon-list"></div></div>
+          <div><h4>Imunidades</h4><div id="immunities" class="icon-list"></div></div>
         </div>
 
-        <div class="stats-columns">
+        <div class="capacities-wrapper">
+          <div class="capacity"><span class="capacity-title">INTELIGÊNCIA</span><span class="capacity-value" id="cap-int">0</span><span class="capacity-label" id="cap-int-label"></span></div>
+          <div class="capacity"><span class="capacity-title">FORÇA</span><span class="capacity-value" id="cap-str">0</span><span class="capacity-label" id="cap-str-label"></span></div>
+          <div class="capacity"><span class="capacity-title">DESLOCAMENTO</span><span class="capacity-value" id="cap-mov">0</span><span class="capacity-label" id="cap-mov-label"></span></div>
+        </div>
+
+        <div class="stats-columns" data-mobile-tab="atributos">
           <div>
             <h4>Atributos Basais</h4>
             <ul id="baseStatsList" class="stat-list"></ul>
           </div>
           <div>
             <h4>Pontos por nível</h4>
             <ul id="levelStatsList" class="stat-list"></ul>
           </div>
           <div>
             <h4>Atributos Finais</h4>
             <ul id="finalStatsList" class="stat-list"></ul>
           </div>
         </div>
 
+        <div id="natureTaste" class="builder-block mini"></div>
+
         <div class="health-bars">
           <div class="hp-item">
-            <span>HP1</span>
+            <span>[HP total]</span>
             <div class="hp-bar hp1"><span id="hp1Fill"></span></div>
             <small id="hp1Text"></small>
           </div>
           <div class="hp-item">
-            <span>HP2</span>
+            <span>[HP Rápido]</span>
             <div class="hp-bar hp2"><span id="hp2Fill"></span></div>
             <small id="hp2Text"></small>
           </div>
         </div>
 
         <h4>Golpes selecionados</h4>
         <ul id="selectedMovesOutput" class="move-output"></ul>
 
+        <div class="radars-wrap" data-mobile-tab="radars">
+          <canvas id="statsRadar" width="220" height="220"></canvas>
+          <canvas id="contestRadar" width="220" height="220"></canvas>
+        </div>
+
         <div class="actions-row">
           <button id="copySheetBtn" type="button">Copiar ficha</button>
           <button id="copyMovesBtn" type="button">Copiar golpes</button>
           <button id="saveJsonBtn" type="button">Salvar JSON</button>
         </div>
       </div>
     </section>
   </main>
+
+  <dialog id="abilitiesModal" class="sheet-modal">
+    <div class="modal-head"><h3>Selecionar habilidades</h3><button data-close-modal="abilitiesModal" type="button">✕</button></div>
+    <div id="abilitiesModalBody"></div>
+  </dialog>
+
+  <dialog id="moveDetailsModal" class="sheet-modal">
+    <div class="modal-head"><h3 id="moveModalTitle">Detalhes do golpe</h3><button data-close-modal="moveDetailsModal" type="button">✕</button></div>
+    <div id="moveDetailsBody"></div>
+  </dialog>
 </body>
 </html>
diff --git a/css/creation.css b/css/creation.css
index 0bec7c6cc419e948d74fcb8749ede1a54b618516..32176d5c5f98fa218a42ce2293cc84ff2b02a64c 100644
--- a/css/creation.css
+++ b/css/creation.css
@@ -1,183 +1,70 @@
-.creation-layout {
-  display: grid;
-  grid-template-columns: 1.1fr 1fr;
-  gap: 16px;
-  padding: 16px;
-}
-
-.builder-panel,
-.sheet-panel {
-  background: linear-gradient(180deg, #16291f, #0d1712);
-  border: 2px solid #2f6b44;
-  border-radius: 14px;
-  padding: 14px;
-  box-shadow: 0 0 12px #000;
-}
-
-.mode-switch {
-  display: flex;
-  gap: 8px;
-  flex-wrap: wrap;
-  margin-bottom: 12px;
-}
-
-.mode-btn,
-.builder-block button,
-.actions-row button,
-.inline-row button {
-  border: 1px solid #7bdc65;
-  background: #163321;
-  color: #fff;
-  border-radius: 8px;
-  padding: 8px 10px;
-  font-family: Pixel;
-  cursor: pointer;
-}
-
-.mode-btn.active {
-  background: #2b6a3e;
-}
-
-.builder-block {
-  border: 1px solid rgba(123, 220, 101, 0.5);
-  border-radius: 10px;
-  padding: 10px;
-  margin-bottom: 10px;
-}
-
-.builder-block h3,
-.sheet-panel h3,
-.sheet-panel h4 {
-  margin: 0 0 8px;
-  font-family: Pixel;
-  color: #7bdc65;
-}
-
-label,
-.helper-text,
-.sheet-panel,
-input,
-select,
-button {
-  font-family: Pixel;
-}
-
-input,
-select {
-  width: 100%;
-  margin-top: 4px;
-  margin-bottom: 8px;
-  background: #08110d;
-  color: #fff;
-  border: 1px solid #2f6b44;
-  border-radius: 8px;
-  padding: 8px;
-}
-
-.inline-toggle {
-  display: flex;
-  align-items: center;
-  gap: 8px;
-}
-
-.search-controls,
-.inline-row {
-  display: flex;
-  gap: 8px;
-}
-
-.search-preview {
-  margin-top: 8px;
-  max-height: 180px;
-  overflow-y: auto;
-}
-
-.preview-item {
-  width: 100%;
-  text-align: left;
-  display: flex;
-  align-items: center;
-  gap: 8px;
-  margin-bottom: 6px;
-}
-
-.preview-item img {
-  width: 36px;
-  height: 36px;
-}
-
-.ability-grid,
-.move-builder-grid,
-.stats-columns {
-  display: grid;
-  grid-template-columns: repeat(2, 1fr);
-  gap: 8px;
-}
-
-.stats-columns {
-  grid-template-columns: repeat(3, 1fr);
-}
-
-.stat-list,
-.move-slots,
-.move-output {
-  list-style: none;
-  margin: 0;
-  padding: 0;
-}
-
-.stat-list li,
-.move-slots li,
-.move-output li {
-  background: rgba(255, 255, 255, 0.04);
-  border: 1px solid rgba(123, 220, 101, 0.3);
-  border-radius: 6px;
-  padding: 6px;
-  margin-bottom: 6px;
-}
-
-.stat-positive { color: #77b6ff; }
-.stat-negative { color: #ff7272; }
-
-.sheet-head {
-  display: flex;
-  gap: 10px;
-  margin-bottom: 10px;
-  align-items: center;
-}
-
-.sheet-head img { width: 120px; }
-
-.health-bars {
-  display: grid;
-  grid-template-columns: repeat(2, 1fr);
-  gap: 10px;
-  margin: 10px 0;
-}
-
-.hp-bar {
-  background: #1d2520;
-  border: 1px solid #324c3a;
-  border-radius: 999px;
-  height: 16px;
-  overflow: hidden;
-}
-
-.hp-bar span { display: block; height: 100%; width: 100%; }
-.hp1 span { background: linear-gradient(90deg, #23ab3a, #89db76); }
-.hp2 span { background: linear-gradient(90deg, #bf2a3a, #f56e6e); }
-
-.actions-row {
-  display: flex;
-  gap: 8px;
-  flex-wrap: wrap;
-  margin-top: 10px;
-}
-
+* { box-sizing: border-box; }
+.creation-layout { display: grid; grid-template-columns: 1.1fr 1fr; gap: 16px; padding: 16px; max-width: 100%; overflow-x: hidden; }
+.builder-panel,.sheet-panel { background: linear-gradient(180deg, #16291f, #0d1712); border: 2px solid #2f6b44; border-radius: 14px; padding: 14px; box-shadow: 0 0 12px #000; min-width: 0; }
+.mode-switch,.mobile-tabs { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
+.mobile-tabs { padding: 0 16px; display: none; }
+.mode-btn,.builder-block button,.actions-row button,.inline-row button,.mobile-tab-btn { border: 1px solid #7bdc65; background: #163321; color: #fff; border-radius: 8px; padding: 8px 10px; font-family: Pixel; cursor: pointer; }
+.mode-btn.active,.mobile-tab-btn.active,.icon-toggle.active { background: #2b6a3e; box-shadow: 0 0 10px rgba(123,220,101,.6); }
+.builder-block { border: 1px solid rgba(123,220,101,.5); border-radius: 10px; padding: 10px; margin-bottom: 10px; }
+.builder-block h3,.sheet-panel h3,.sheet-panel h4 { margin: 0 0 8px; font-family: Pixel; color: #7bdc65; }
+label,.helper-text,.sheet-panel,input,select,button,small,span,p,strong,li { font-family: Pixel; }
+input,select { width: 100%; margin-top: 4px; margin-bottom: 8px; background: #08110d; color: #fff; border: 1px solid #2f6b44; border-radius: 8px; padding: 8px; min-width: 0; }
+.search-controls,.inline-row,.details-header-row,.compact-two-grid,.sheet-info-grid { display: grid; gap: 8px; align-items: end; }
+.search-controls { grid-template-columns: minmax(0,1fr) auto; }
+.search-preview { margin-top: 8px; max-height: 220px; overflow-y: auto; border: 1px solid rgba(123,220,101,.3); border-radius: 8px; }
+.preview-item { width: 100%; text-align: left; display: flex; align-items: center; gap: 8px; margin: 0; border-radius: 0; border: none; border-bottom: 1px solid rgba(123,220,101,.2); background: transparent; padding: 8px; }
+.preview-item img { width: 36px; height: 36px; }
+.compact-two-grid { grid-template-columns: repeat(2,minmax(0,1fr)); }
+.details-header-row { grid-template-columns: 90px minmax(0,1fr); }
+.compact-level input { width: 72px; text-align: center; }
+.icon-toggle-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 8px; }
+.icon-toggle { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; }
+.icon-toggle img { width: 20px; height: 20px; object-fit: contain; }
+.icon-toggle.active { box-shadow: 0 0 12px rgba(255, 236, 130, .85); border-color: #ffe774; }
+.abilities-launcher small { display: block; color: #c8e7c0; margin-top: 4px; }
+.move-builder-grid,.stats-columns { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 8px; }
+.stats-columns { grid-template-columns: repeat(3,minmax(0,1fr)); }
+.stat-list,.move-slots,.move-output,.icon-list { list-style: none; margin: 0; padding: 0; }
+.stat-list li,.move-slots li,.move-output li { background: rgba(255,255,255,.04); border: 1px solid rgba(123,220,101,.3); border-radius: 6px; padding: 6px; margin-bottom: 6px; }
+.move-output li { cursor: pointer; }
+.move-output li:hover { border-color: #7bdc65; }
+.stat-positive { color: #77b6ff; } .stat-negative { color: #ff7272; }
+.sheet-head { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
+.sheet-head img { width: 110px; }
+.cry-mini { margin-left: auto; }
+.sheet-info-grid { grid-template-columns: repeat(3,minmax(0,1fr)); margin-bottom: 8px; }
+.sheet-info-grid img,.icon-list img,#sheetTypes img { width: 24px; height: 24px; object-fit: contain; }
+#sheetTypes { display: inline-flex; gap: 4px; }
+.type-relations { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 8px; }
+.icon-list { display: flex; gap: 4px; flex-wrap: wrap; }
+.capacities-wrapper { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 8px; margin: 10px 0; }
+.capacity { border: 1px solid rgba(123,220,101,.3); border-radius: 8px; padding: 6px; text-align: center; }
+.capacity-title { font-size: 10px; display: block; }
+.capacity-value { font-size: 22px; color: #7bdc65; display: block; }
+.capacity-label { font-size: 11px; opacity: .9; }
+.health-bars { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 10px; margin: 10px 0; }
+.hp-bar { background: #1d2520; border: 1px solid #324c3a; border-radius: 999px; height: 16px; overflow: hidden; }
+.hp-bar span { display: block; height: 100%; width: 100%; } .hp1 span { background: linear-gradient(90deg,#23ab3a,#89db76);} .hp2 span { background: linear-gradient(90deg,#bf2a3a,#f56e6e);}
+.radars-wrap { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 8px; margin-top: 10px; }
+.radars-wrap canvas { width: 100% !important; max-width: 260px; height: 220px !important; background: rgba(0,0,0,.2); border-radius: 8px; padding: 6px; }
+.actions-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
+.sheet-modal { width: min(700px, 96vw); border: 1px solid #7bdc65; border-radius: 12px; background: #102117; color: #fff; padding: 0; }
+.sheet-modal::backdrop { background: rgba(0,0,0,.65); }
+.modal-head { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #2f6b44; }
+#abilitiesModalBody,#moveDetailsBody { padding: 10px; max-height: 70vh; overflow-y: auto; }
+.ability-option { border: 1px solid rgba(123,220,101,.35); border-radius: 8px; padding: 8px; margin-bottom: 8px; }
+.ability-buttons { display: flex; gap: 6px; margin-top: 6px; }
+.move-table { width: 100%; border-collapse: collapse; }
+.move-table th,.move-table td { border-bottom: 1px solid rgba(123,220,101,.25); padding: 4px; text-align: left; font-size: 12px; }
+.alloc-input { width: 52px; padding: 4px; margin-left: 6px; }
+.nature-pill { color:#7bdc65; }
 @media (max-width: 1000px) {
   .creation-layout { grid-template-columns: 1fr; }
-  .stats-columns,
-  .move-builder-grid,
-  .ability-grid,
-  .health-bars { grid-template-columns: 1fr; }
+  .stats-columns,.move-builder-grid,.health-bars,.compact-two-grid,.sheet-info-grid,.capacities-wrapper,.type-relations,.radars-wrap { grid-template-columns: 1fr; }
+  .mobile-tabs { display: flex; }
+  .creation-layout [data-mobile-tab] { display: none; }
+  .creation-layout [data-mobile-tab].mobile-visible { display: block; }
+  .sheet-panel[data-mobile-tab="ficha"].mobile-visible { display: block; }
+  .builder-panel,.sheet-panel { padding: 10px; }
+  .sheet-modal { margin: auto 0 0; width: 100vw; max-width: 100vw; border-radius: 14px 14px 0 0; }
 }
diff --git a/js/creation.js b/js/creation.js
index af715d04e8c8f41ed486bc0566639ba1a747cc88..cc428032db59ae46b31cd26d820f612705580aa8 100644
--- a/js/creation.js
+++ b/js/creation.js
@@ -1,420 +1,69 @@
 import { powerToDamage } from "./utils.js";
+import { abilitiesData } from "./abilities.js";
 
 const VERSION_PRIORITY = ["scarlet-violet", "sword-shield", "ultra-sun-ultra-moon", "sun-moon"];
-const NATURES = [
-  ["Hardy", null, null],["Lonely", "atk", "def"],["Brave", "atk", "spd"],["Adamant", "atk", "spatk"],["Naughty", "atk", "spdef"],
-  ["Bold", "def", "atk"],["Docile", null, null],["Relaxed", "def", "spd"],["Impish", "def", "spatk"],["Lax", "def", "spdef"],
-  ["Timid", "spd", "atk"],["Hasty", "spd", "def"],["Serious", null, null],["Jolly", "spd", "spatk"],["Naive", "spd", "spdef"],
-  ["Modest", "spatk", "atk"],["Mild", "spatk", "def"],["Quiet", "spatk", "spd"],["Bashful", null, null],["Rash", "spatk", "spdef"],
-  ["Calm", "spdef", "atk"],["Gentle", "spdef", "def"],["Sassy", "spdef", "spd"],["Careful", "spdef", "spatk"],["Quirky", null, null],
-].map(([name, plus, minus]) => ({ name, plus, minus }));
 const STAT_KEYS = ["hp", "atk", "def", "spatk", "spdef", "spd"];
-const STAT_LABELS = { hp: "Saúde", atk: "Ataque", def: "Defesa", spatk: "Ataque Esp.", spdef: "Defesa Esp.", spd: "Velocidade" };
-
-const state = {
-  mode: "wild",
-  pokemonIndex: [],
-  pokemon: null,
-  species: null,
-  levelMoves: [],
-  tmMoves: [],
-  selectedLevelMoves: [],
-  selectedTmMoves: [],
-  moveCache: new Map(),
-};
-
+const STAT_LABELS = { hp: "Saúde", atk: "Ataque", def: "Defesa", spatk: "sp.atk", spdef: "sp.def", spd: "Velocidade" };
+const state = { mode: "wild", pokemonIndex: [], pokemon: null, species: null, levelMoves: [], tmMoves: [], selectedLevelMoves: [], selectedTmMoves: [], moveCache: new Map(), statsChart: null, contestChart: null, abilitySlots: ["", ""] };
 const $ = (id) => document.getElementById(id);
-
-function convertStat(value) {
-  const base = Math.floor(value / 10);
-  return value % 10 >= 9 ? base + 1 : base;
-}
-function formatName(name) {
-  return name.split("-").map((part) => part[0].toUpperCase() + part.slice(1)).join(" ");
-}
-function notify(msg) { alert(msg); }
-
-function setupMenu() {
-  const btn = $("logoMenuBtn");
-  const menu = $("sideMenu");
-  const backdrop = $("sideMenuBackdrop");
-  btn?.addEventListener("click", () => { menu?.classList.add("open"); backdrop?.classList.remove("hidden"); menu?.setAttribute("aria-hidden", "false"); });
-  backdrop?.addEventListener("click", () => { menu?.classList.remove("open"); backdrop?.classList.add("hidden"); menu?.setAttribute("aria-hidden", "true"); });
-}
-
-async function fetchPokemonIndex() {
-  const response = await fetch("https://pokeapi.co/api/v2/pokemon?limit=1025").then((r) => r.json());
-  state.pokemonIndex = response.results.map((p, idx) => ({ id: idx + 1, name: p.name }));
-}
-
-function setupModes() {
-  document.querySelectorAll(".mode-btn").forEach((btn) => {
-    btn.addEventListener("click", () => {
-      state.mode = btn.dataset.mode;
-      document.querySelectorAll(".mode-btn").forEach((el) => el.classList.toggle("active", el === btn));
-      document.querySelectorAll(".mode-only").forEach((el) => { el.hidden = el.dataset.modeOnly !== state.mode; });
-      renderSheet();
-    });
-  });
-  document.querySelector('.mode-btn[data-mode="wild"]').click();
-}
-
-function setupSearch() {
-  const input = $("speciesSearch");
-  input.addEventListener("input", updatePreview);
-  $("speciesSearchBtn").addEventListener("click", async () => {
-    const query = input.value.trim().toLowerCase();
-    if (!query) return;
-    await loadSpecies(query);
-  });
-}
-
-function updatePreview() {
-  const q = $("speciesSearch").value.trim().toLowerCase();
-  const preview = $("speciesPreview");
-  preview.innerHTML = "";
-  if (!q) return;
-  const list = state.pokemonIndex.filter((p) => p.name.includes(q) || String(p.id).startsWith(q)).slice(0, 8);
-  list.forEach((p) => {
-    const btn = document.createElement("button");
-    btn.type = "button";
-    btn.className = "preview-item";
-    btn.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${p.id}.png" alt="${p.name}"><span>#${String(p.id).padStart(4, "0")} ${formatName(p.name)}</span>`;
-    btn.addEventListener("click", () => loadSpecies(String(p.id)));
-    preview.appendChild(btn);
-  });
-}
-
-function pickVersion(details) {
-  return [...details].sort((a, b) => VERSION_PRIORITY.indexOf(a.version_group.name) - VERSION_PRIORITY.indexOf(b.version_group.name))[0];
-}
-
-async function getMove(url) {
-  if (state.moveCache.has(url)) return state.moveCache.get(url);
-  const data = await fetch(url).then((r) => r.json());
-  state.moveCache.set(url, data);
-  return data;
-}
-
-async function loadSpecies(idOrName) {
-  const pokemon = await fetch(`https://pokeapi.co/api/v2/pokemon/${idOrName}`).then((r) => r.json());
-  const species = await fetch(pokemon.species.url).then((r) => r.json());
-  state.pokemon = pokemon;
-  state.species = species;
-  state.selectedLevelMoves = [];
-  state.selectedTmMoves = [];
-  $("sheetEmpty").hidden = true;
-  $("sheetContent").hidden = false;
-  $("basicControls").hidden = false;
-  $("movesSection").hidden = false;
-  fillBasics();
-  await buildMovePools();
-  renderMoveOptions();
-  renderSelectedMoves();
-  renderSheet();
-}
-
-function fillBasics() {
-  const gender = $("genderSelect");
-  gender.innerHTML = "";
-  if (state.species.gender_rate === -1) {
-    gender.innerHTML = '<option value="genderless">Sem gênero</option>';
-  } else {
-    gender.innerHTML = '<option value="male">Masculino</option><option value="female">Feminino</option>';
-  }
-  const abilities = state.pokemon.abilities.map((a) => formatName(a.ability.name));
-  $("ability1").innerHTML = abilities.map((a) => `<option>${a}</option>`).join("");
-  $("ability2").innerHTML = abilities.map((a) => `<option>${a}</option>`).join("");
-  const natures = NATURES.map((n) => `<option value="${n.name}">${n.name}</option>`).join("");
-  $("natureSelect").innerHTML = natures;
-  ["levelInput", "natureSelect", "ability1", "ability2", "genderSelect", "shinyToggle", "nicknameInput", "loyaltyInput"].forEach((id) => {
-    const el = $(id); if (!el) return; el.oninput = () => renderSheet(); el.onchange = () => renderSheet();
-  });
-  const alpha = $("alphaToggle");
-  if (alpha) {
-    alpha.onchange = async () => {
-      if (alpha.checked) applyAlphaMoveRule();
-      await renderSelectedMoves();
-      renderSheet();
-    };
-  }
-  enforceAbilityRule();
-  $("levelInput").addEventListener("input", async () => {
-    enforceAbilityRule();
-    renderMoveOptions();
-    if ($("alphaToggle")?.checked) applyAlphaMoveRule();
-    await renderSelectedMoves();
-    renderSheet();
-  });
-}
-
-function enforceAbilityRule() {
-  const level = Number($("levelInput").value || 1);
-  const wrap = $("ability2Wrap");
-  wrap.hidden = level < 40;
-}
-
-async function buildMovePools() {
-  state.levelMoves = [];
-  state.tmMoves = [];
-  for (const mv of state.pokemon.moves) {
-    const version = pickVersion(mv.version_group_details);
-    if (!version) continue;
-    const method = version.move_learn_method.name;
-    const entry = { name: mv.move.name, url: mv.move.url, level: version.level_learned_at, method };
-    if (method === "level-up") state.levelMoves.push(entry);
-    if (["machine", "tutor", "egg"].includes(method)) state.tmMoves.push(entry);
-  }
-  state.levelMoves.sort((a, b) => a.level - b.level);
-}
-
-function renderMoveOptions() {
-  const level = Number($("levelInput").value || 1);
-  const levelOptions = state.levelMoves.filter((m) => m.level <= level);
-  $("levelMoveSelect").innerHTML = levelOptions.map((m) => `<option value="${m.name}">${formatName(m.name)} (Nv ${m.level})</option>`).join("");
-  $("tmMoveSelect").innerHTML = state.tmMoves.map((m) => `<option value="${m.name}">${formatName(m.name)} (${m.method.toUpperCase()})</option>`).join("");
-}
-
-function setupMoveActions() {
-  $("addLevelMoveBtn").addEventListener("click", () => addMove("level"));
-  $("addTmMoveBtn").addEventListener("click", () => addMove("tm"));
-}
-
-function addMove(type) {
-  const select = type === "level" ? $("levelMoveSelect") : $("tmMoveSelect");
-  const target = type === "level" ? state.selectedLevelMoves : state.selectedTmMoves;
-  if (!select.value) return;
-  if (target.includes(select.value)) return;
-  if (target.length >= 4) return notify("Limite de 4 golpes nesse grupo.");
-  target.push(select.value);
-  if (state.mode === "wild" && $("alphaToggle").checked) applyAlphaMoveRule();
-  renderSelectedMoves();
-}
-
-function applyAlphaMoveRule() {
-  const level = Number($("levelInput").value || 1);
-  const available = state.levelMoves.filter((m) => m.level <= level);
-  if (!available.length) return;
-  const alphaMove = available[available.length - 1].name;
-  if (state.selectedLevelMoves.includes(alphaMove)) return;
-  if (state.selectedLevelMoves.length < 4) state.selectedLevelMoves.push(alphaMove);
-  else state.selectedLevelMoves[3] = alphaMove;
-}
-
-async function renderSelectedMoves() {
-  const all = [...state.selectedLevelMoves, ...state.selectedTmMoves];
-  const pokeTypes = state.pokemon?.types.map((t) => t.type.name) || [];
-  const level = Number($("levelInput").value || 1);
-  const stabBonus = Math.floor(level / 5);
-
-  const renderList = async (containerId, moves) => {
-    const ul = $(containerId);
-    ul.innerHTML = "";
-    for (const name of moves) {
-      const entry = state.levelMoves.find((m) => m.name === name) || state.tmMoves.find((m) => m.name === name);
-      const li = document.createElement("li");
-      const remove = document.createElement("button");
-      remove.textContent = "Remover";
-      remove.type = "button";
-      remove.addEventListener("click", () => {
-        const target = containerId === "levelMoveSlots" ? state.selectedLevelMoves : state.selectedTmMoves;
-        target.splice(target.indexOf(name), 1);
-        renderSelectedMoves();
-      });
-      const moveData = entry ? await getMove(entry.url) : null;
-      const isStatus = !moveData?.power;
-      const baseDamage = powerToDamage(moveData?.power);
-      const stab = moveData && pokeTypes.includes(moveData.type.name) && !isStatus;
-      const damageText = isStatus ? "—" : stab ? `${baseDamage} + ${stabBonus}` : baseDamage;
-      li.innerHTML = `<strong>${formatName(name)}</strong> • ${entry?.method || "level-up"} • Dano: ${damageText}`;
-      li.appendChild(remove);
-      ul.appendChild(li);
-    }
-  };
-
-  await renderList("levelMoveSlots", state.selectedLevelMoves);
-  await renderList("tmMoveSlots", state.selectedTmMoves);
-
-  const output = $("selectedMovesOutput");
-  output.innerHTML = "";
-  for (const moveName of all) {
-    const li = document.createElement("li");
-    li.textContent = formatName(moveName);
-    output.appendChild(li);
-  }
-}
-
-function getNature() {
-  const name = $("natureSelect").value;
-  return NATURES.find((n) => n.name === name) || NATURES[0];
-}
-
-function getBaseStats() {
-  const raw = {};
-  state.pokemon.stats.forEach((s) => {
-    if (s.stat.name === "special-attack") raw.spatk = convertStat(s.base_stat);
-    else if (s.stat.name === "special-defense") raw.spdef = convertStat(s.base_stat);
-    else if (s.stat.name === "speed") raw.spd = convertStat(s.base_stat);
-    else if (s.stat.name === "attack") raw.atk = convertStat(s.base_stat);
-    else if (s.stat.name === "defense") raw.def = convertStat(s.base_stat);
-    else if (s.stat.name === "hp") raw.hp = convertStat(s.base_stat);
-  });
-  return raw;
-}
-
-function autoDistribute(base, points) {
-  const gains = Object.fromEntries(STAT_KEYS.map((k) => [k, 0]));
-  const ranking = [...STAT_KEYS].sort((a, b) => base[b] - base[a] || STAT_KEYS.indexOf(a) - STAT_KEYS.indexOf(b));
-  for (let i = 0; i < points; i++) gains[ranking[i % ranking.length]] += 1;
-  return gains;
-}
-
-function getAllocatedStats(base) {
-  const points = Number($("levelInput").value || 1);
-  const gains = Object.fromEntries(STAT_KEYS.map((k) => [k, 0]));
-  if (state.mode === "wild" || state.mode === "quick") {
-    Object.assign(gains, autoDistribute(base, points));
-  }
-  if (state.mode === "trained") {
-    STAT_KEYS.forEach((k) => {
-      gains[k] = Number($(`alloc-${k}`)?.value || 0);
-    });
-  }
-  if (state.mode === "wild" && $("alphaToggle").checked) {
-    const top = [...STAT_KEYS].sort((a, b) => base[b] - base[a] || STAT_KEYS.indexOf(a) - STAT_KEYS.indexOf(b)).slice(0, 2);
-    gains[top[0]] += 5;
-    gains[top[1]] += 5;
-  }
-  return { gains, points };
-}
-
-function ensureTrainedInputs(base, points) {
-  const list = $("levelStatsList");
-  if (state.mode !== "trained") return;
-  if (list.querySelector("input")) return;
-  list.innerHTML = "";
-  STAT_KEYS.forEach((k) => {
-    const li = document.createElement("li");
-    li.innerHTML = `${STAT_LABELS[k]}: <input id="alloc-${k}" type="number" min="0" max="${points}" value="0">`;
-    list.appendChild(li);
-  });
-  list.querySelectorAll("input").forEach((inp) => inp.addEventListener("input", renderSheet));
-}
-
-function renderSheet() {
-  if (!state.pokemon) return;
-  const base = getBaseStats();
-  const points = Number($("levelInput").value || 1);
-  ensureTrainedInputs(base, points);
-  const { gains } = getAllocatedStats(base);
-  const nature = getNature();
-
-  const finalStats = Object.fromEntries(STAT_KEYS.map((k) => [k, base[k] + gains[k]]));
-  if (nature.plus) finalStats[nature.plus] += 2;
-  if (nature.minus) finalStats[nature.minus] -= 2;
-
-  $("sheetSprite").src = $("shinyToggle").checked
-    ? (state.pokemon.sprites.other["official-artwork"].front_shiny || state.pokemon.sprites.front_shiny)
-    : (state.pokemon.sprites.other["official-artwork"].front_default || state.pokemon.sprites.front_default);
-  $("sheetName").textContent = (state.mode === "trained" && $("nicknameInput").value.trim())
-    ? `${$("nicknameInput").value.trim()} (${formatName(state.pokemon.name)})`
-    : formatName(state.pokemon.name);
-  $("sheetMeta").textContent = `Nv ${points} • ${$("genderSelect").value} • Nature: ${nature.name}`;
-  $("sheetModeLabel").textContent = `Modo: ${state.mode === "wild" ? "Selvagem" : state.mode === "trained" ? "Adestrado" : "Geração Rápida"}`;
-
-  const baseList = $("baseStatsList");
-  const gainsList = $("levelStatsList");
-  const finalList = $("finalStatsList");
-
-  baseList.innerHTML = "";
-  if (state.mode !== "trained") gainsList.innerHTML = "";
-  finalList.innerHTML = "";
-
-  STAT_KEYS.forEach((k) => {
-    baseList.innerHTML += `<li>${STAT_LABELS[k]}: <strong>${base[k]}</strong></li>`;
-    if (state.mode !== "trained") gainsList.innerHTML += `<li>${STAT_LABELS[k]}: +${gains[k]}</li>`;
-    const natureClass = nature.plus === k ? "stat-positive" : nature.minus === k ? "stat-negative" : "";
-    finalList.innerHTML += `<li class="${natureClass}">${STAT_LABELS[k]}: <strong>${finalStats[k]}</strong></li>`;
-  });
-
-  const hpStat = finalStats.hp;
-  const hp1 = (hpStat + points) * 4;
-  const hp2 = points + hpStat * 3;
-  $("hp1Text").textContent = `${hp1} / ${hp1}`;
-  $("hp2Text").textContent = `${hp2} / ${hp2}`;
-}
-
-function setupQuickGeneration() {
-  $("quickGenerateBtn").addEventListener("click", async () => {
-    if (!state.pokemonIndex.length) return;
-    const random = state.pokemonIndex[Math.floor(Math.random() * state.pokemonIndex.length)];
-    await loadSpecies(String(random.id));
-    $("levelInput").value = Math.floor(Math.random() * 100) + 1;
-    $("natureSelect").value = NATURES[Math.floor(Math.random() * NATURES.length)].name;
-    renderMoveOptions();
-    state.selectedLevelMoves = state.levelMoves.filter((m) => m.level <= Number($("levelInput").value)).slice(-4).map((m) => m.name);
-    state.selectedTmMoves = state.tmMoves.slice(0, 4).map((m) => m.name);
-    await renderSelectedMoves();
-    renderSheet();
-  });
-}
-
-function getSheetPayload() {
-  const base = getBaseStats();
-  const { gains, points } = getAllocatedStats(base);
-  const unspent = state.mode === "trained" ? Math.max(points - Object.values(gains).reduce((a, b) => a + b, 0), 0) : 0;
-  if (unspent > 0) notify(`Ainda faltam ${unspent} pontos para distribuir.`);
-  const nature = getNature();
-  return {
-    mode: state.mode,
-    pokemon: state.pokemon.name,
-    level: points,
-    shiny: $("shinyToggle").checked,
-    gender: $("genderSelect").value,
-    abilities: [$("ability1").value, $("ability2Wrap").hidden ? null : $("ability2").value].filter(Boolean),
-    nickname: $("nicknameInput")?.value || "",
-    loyalty: Number($("loyaltyInput")?.value || 0),
-    alpha: $("alphaToggle")?.checked || false,
-    nature,
-    base,
-    gains,
-    moves: { level: [...state.selectedLevelMoves], tm: [...state.selectedTmMoves] },
-  };
-}
-
-function setupExport() {
-  $("copySheetBtn").addEventListener("click", async () => {
-    const payload = getSheetPayload();
-    const text = `[${formatName(payload.pokemon)}] Nv.${payload.level} (${payload.mode})\nNature: ${payload.nature.name}\nHabilidades: ${payload.abilities.join(", ")}\nLealdade: ${payload.loyalty}\nBase: ${JSON.stringify(payload.base)}\nGanhos: ${JSON.stringify(payload.gains)}`;
-    await navigator.clipboard.writeText(text);
-    notify("Ficha copiada!");
-  });
-  $("copyMovesBtn").addEventListener("click", async () => {
-    const payload = getSheetPayload();
-    const text = [...payload.moves.level, ...payload.moves.tm].map((m) => `- ${formatName(m)}`).join("\n");
-    await navigator.clipboard.writeText(text);
-    notify("Golpes copiados!");
-  });
-  $("saveJsonBtn").addEventListener("click", () => {
-    const payload = getSheetPayload();
-    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
-    const url = URL.createObjectURL(blob);
-    const a = document.createElement("a");
-    a.href = url;
-    a.download = `${payload.pokemon}-ficha.json`;
-    a.click();
-    URL.revokeObjectURL(url);
-  });
-}
-
-async function init() {
-  setupMenu();
-  setupModes();
-  setupSearch();
-  setupMoveActions();
-  setupQuickGeneration();
-  setupExport();
-  await fetchPokemonIndex();
-}
-
+const NATURES = [["Hardy",null,null,"Estoica","Neutra"],["Lonely","atk","def","Desesperada","Gosta de Picante e não gosta de Azedo"],["Brave","atk","spd","Travessa","Gosta de Picante e não gosta de Doce"],["Adamant","atk","spatk","Solitária","Gosta de Picante e não gosta de Seco"],["Naughty","atk","spdef","Firme","Gosta de Picante e não gosta de Amargo"],["Bold","def","atk","Ousada","Gosta de Azedo e não gosta de Picante"],["Docile",null,null,"Dócil","Neutra"],["Relaxed","def","spd","Relaxada","Gosta de Azedo e não gosta de Doce"],["Impish","def","spatk","Orgulhosa","Gosta de Azedo e não gosta de Seco"],["Lax","def","spdef","Excêntrica","Gosta de Azedo e não gosta de Amargo"],["Timid","spd","atk","Medrosa","Gosta de Doce e não gosta de Picante"],["Hasty","spd","def","Apressada","Gosta de Doce e não gosta de Azedo"],["Serious",null,null,"Séria","Neutra"],["Jolly","spd","spatk","Alegre","Gosta de Doce e não gosta de Seco"],["Naive","spd","spdef","Ingênua","Gosta de Doce e não gosta de Amargo"],["Modest","spatk","atk","Tímida","Gosta de Seco e não gosta de Picante"],["Mild","spatk","def","Modesta","Gosta de Seco e não gosta de Azedo"],["Quiet","spatk","spd","Quieta","Gosta de Seco e não gosta de Doce"],["Bashful",null,null,"Comedida","Neutra"],["Rash","spatk","spdef","Amável","Gosta de Seco e não gosta de Amargo"],["Calm","spdef","atk","Enjoada","Gosta de Amargo e não gosta de Picante"],["Gentle","spdef","def","Calma","Gosta de Amargo e não gosta de Azedo"],["Sassy","spdef","spd","Atrevida","Gosta de Amargo e não gosta de Doce"],["Careful","spdef","spatk","Gentil","Gosta de Amargo e não gosta de Seco"],["Quirky",null,null,"Chata","Neutra"]].map(([name,plus,minus,pt,taste])=>({name,plus,minus,pt,taste}));
+
+const convertStat = (v) => (v % 10 >= 9 ? Math.floor(v / 10) + 1 : Math.floor(v / 10));
+const formatName = (name) => name.split("-").map((p) => p[0].toUpperCase() + p.slice(1)).join(" ");
+const notify = (m) => alert(m);
+const capLabel = (v, t) => t[v] || t[Object.keys(t).length - 1];
+
+function setupMenu(){const btn=$("logoMenuBtn"),menu=$("sideMenu"),backdrop=$("sideMenuBackdrop");btn?.addEventListener("click",()=>{menu?.classList.add("open");backdrop?.classList.remove("hidden");});backdrop?.addEventListener("click",()=>{menu?.classList.remove("open");backdrop?.classList.add("hidden");});}
+async function fetchPokemonIndex(){const r=await fetch("https://pokeapi.co/api/v2/pokemon?limit=1025").then(x=>x.json());state.pokemonIndex=r.results.map((p,i)=>({id:i+1,name:p.name}));}
+function setupModes(){document.querySelectorAll(".mode-btn").forEach((btn)=>btn.addEventListener("click",()=>{state.mode=btn.dataset.mode;document.querySelectorAll(".mode-btn").forEach((e)=>e.classList.toggle("active",e===btn));document.querySelectorAll(".mode-only").forEach((e)=>e.hidden=e.dataset.modeOnly!==state.mode);renderSheet();}));document.querySelector('.mode-btn[data-mode="wild"]').click();}
+function setupMobileTabs(){const tabs=[...document.querySelectorAll(".mobile-tab-btn")];tabs.forEach((b)=>b.addEventListener("click",()=>{tabs.forEach((x)=>x.classList.toggle("active",x===b));const target=b.dataset.mobileTabTarget;document.querySelectorAll("[data-mobile-tab]").forEach((s)=>s.classList.toggle("mobile-visible",s.dataset.mobileTab===target));if(["atributos","radars"].includes(target)) $("sheetContent")?.classList.add("mobile-visible");}));tabs[0]?.click();}
+function setupSearch(){const input=$("speciesSearch");input.addEventListener("input",updatePreview);$("speciesSearchBtn").addEventListener("click",()=>loadSpecies(input.value.trim().toLowerCase()));}
+function updatePreview(){const q=$("speciesSearch").value.trim().toLowerCase(),preview=$("speciesPreview");preview.innerHTML="";if(!q)return;state.pokemonIndex.filter((p)=>p.name.includes(q)||String(p.id).startsWith(q)).slice(0,12).forEach((p)=>{const btn=document.createElement("button");btn.type="button";btn.className="preview-item";btn.innerHTML=`<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${p.id}.png" alt="${p.name}"><span>#${String(p.id).padStart(4,"0")} ${formatName(p.name)}</span>`;btn.addEventListener("click",()=>{ $("speciesSearch").value=p.name;preview.innerHTML="";loadSpecies(String(p.id));});preview.appendChild(btn);});}
+const pickVersion = (d) => [...d].sort((a,b)=>VERSION_PRIORITY.indexOf(a.version_group.name)-VERSION_PRIORITY.indexOf(b.version_group.name))[0];
+async function getMove(url){if(state.moveCache.has(url))return state.moveCache.get(url);const d=await fetch(url).then((r)=>r.json());state.moveCache.set(url,d);return d;}
+
+async function loadSpecies(idOrName){if(!idOrName)return;const pokemon=await fetch(`https://pokeapi.co/api/v2/pokemon/${idOrName}`).then((r)=>r.json());const species=await fetch(pokemon.species.url).then((r)=>r.json());state.pokemon=pokemon;state.species=species;state.selectedLevelMoves=[];state.selectedTmMoves=[];$("sheetEmpty").hidden=true;$("sheetContent").hidden=false;$("basicControls").hidden=false;$("movesSection").hidden=false;fillBasics();await buildMovePools();renderMoveOptions();await renderSelectedMoves();await renderDamageRelations();renderSheet();}
+
+function fillBasics(){renderGenderButtons();state.abilitySlots=[state.pokemon.abilities[0]?.ability.name||"",state.pokemon.abilities[1]?.ability.name||""];$("natureSelect").innerHTML=NATURES.map((n)=>`<option value="${n.name}">${n.pt} (${n.name})</option>`).join("");["levelInput","natureSelect","nicknameInput","loyaltyInput"].forEach((id)=>$(id)?.addEventListener("input",async()=>{enforceAbilityRule();renderMoveOptions();if(isAlpha()) applyAlphaMoveRule();await renderSelectedMoves();renderSheet();}));$("shinyToggle").addEventListener("click",()=>toggleIconButton("shinyToggle",renderSheet));$("alphaToggle").addEventListener("click",async()=>toggleIconButton("alphaToggle",async()=>{if(isAlpha())applyAlphaMoveRule();await renderSelectedMoves();renderSheet();}));$("openAbilitiesModalBtn").onclick=()=>openAbilitiesModal();enforceAbilityRule();renderAbilitySummary();}
+function toggleIconButton(id,cb){const b=$(id);b.classList.toggle("active");b.setAttribute("aria-pressed",String(b.classList.contains("active")));cb?.();}
+const isShiny=()=>$("shinyToggle").classList.contains("active");
+const isAlpha=()=>$("alphaToggle").classList.contains("active");
+function renderGenderButtons(){const c=$("genderButtons");c.innerHTML="";if(state.species.gender_rate===-1){c.innerHTML='<span>assexual</span>';return;}const make=(id,text,icon)=>{const b=document.createElement("button");b.type="button";b.id=id;b.className="icon-toggle";b.innerHTML=`<img src="${icon}" alt="${text}"><span>${text}</span>`;b.addEventListener("click",()=>{document.querySelectorAll("#genderButtons .icon-toggle").forEach((x)=>x.classList.remove("active"));b.classList.add("active");renderSheet();});return b;};c.append(make("genderMale","Masculino","assets/icons/male.png"),make("genderFemale","Feminino","assets/icons/female.png"));$("genderMale").classList.add("active");}
+function selectedGender(){if(state.species.gender_rate===-1)return "assexual";return $("genderFemale")?.classList.contains("active")?"feminino":"masculino";}
+function enforceAbilityRule(){const level=Number($("levelInput").value||1);state.abilitySlots[1]=level>=40?state.abilitySlots[1]:"";renderAbilitySummary();}
+
+async function buildMovePools(){state.levelMoves=[];state.tmMoves=[];for(const mv of state.pokemon.moves){const version=pickVersion(mv.version_group_details);if(!version)continue;const entry={name:mv.move.name,url:mv.move.url,level:version.level_learned_at,method:version.move_learn_method.name};if(entry.method==="level-up")state.levelMoves.push(entry);if(["machine","tutor","egg"].includes(entry.method))state.tmMoves.push(entry);}state.levelMoves.sort((a,b)=>a.level-b.level);}
+function renderMoveOptions(){const level=Number($("levelInput").value||1);$("levelMoveSelect").innerHTML=state.levelMoves.filter((m)=>m.level<=level).map((m)=>`<option value="${m.name}">${m.level} • ${formatName(m.name)}</option>`).join("");$("tmMoveSelect").innerHTML=state.tmMoves.map((m)=>`<option value="${m.name}">${m.method.toUpperCase()} • ${formatName(m.name)}</option>`).join("");}
+function setupMoveActions(){$("addLevelMoveBtn").addEventListener("click",()=>addMove("level"));$("addTmMoveBtn").addEventListener("click",()=>addMove("tm"));}
+function addMove(type){const select=type==="level"?$("levelMoveSelect"):$("tmMoveSelect");const target=type==="level"?state.selectedLevelMoves:state.selectedTmMoves;if(!select.value||target.includes(select.value))return;if(target.length>=4)return notify("Limite de 4 golpes nesse grupo.");target.push(select.value);if(state.mode==="wild"&&isAlpha())applyAlphaMoveRule();renderSelectedMoves();}
+function applyAlphaMoveRule(){const alphaMove=state.levelMoves[state.levelMoves.length-1]?.name;if(!alphaMove)return;if(state.selectedLevelMoves.includes(alphaMove))return;if(state.selectedLevelMoves.length<4)state.selectedLevelMoves.push(alphaMove);else state.selectedLevelMoves[3]=alphaMove;}
+async function renderSelectedMoves(){const renderList=async(id,moves)=>{const ul=$(id);ul.innerHTML="";for(const name of moves){const entry=state.levelMoves.find((m)=>m.name===name)||state.tmMoves.find((m)=>m.name===name);const li=document.createElement("li");li.innerHTML=`<table class="move-table"><tr><td>${entry.method==='level-up'?entry.level:entry.method.toUpperCase()}</td><td>${formatName(name)}</td><td><img src="assets/types/${(await getMove(entry.url)).type.name}.png"></td><td>${(await getMove(entry.url)).damage_class.name}</td></tr></table>`;const rm=document.createElement("button");rm.type="button";rm.textContent="Remover";rm.onclick=()=>{const t=id==="levelMoveSlots"?state.selectedLevelMoves:state.selectedTmMoves;t.splice(t.indexOf(name),1);renderSelectedMoves();};li.appendChild(rm);ul.appendChild(li);}};await renderList("levelMoveSlots",state.selectedLevelMoves);await renderList("tmMoveSlots",state.selectedTmMoves);const output=$("selectedMovesOutput");output.innerHTML="";for(const moveName of [...state.selectedLevelMoves,...state.selectedTmMoves]){const li=document.createElement("li");li.textContent=formatName(moveName);li.onclick=()=>openMoveModal(moveName);output.appendChild(li);} }
+
+const getNature=()=>NATURES.find((n)=>n.name===$("natureSelect").value)||NATURES[0];
+function getBaseStats(){const raw={};state.pokemon.stats.forEach((s)=>{if(s.stat.name==="special-attack")raw.spatk=convertStat(s.base_stat);else if(s.stat.name==="special-defense")raw.spdef=convertStat(s.base_stat);else if(s.stat.name==="speed")raw.spd=convertStat(s.base_stat);else if(s.stat.name==="attack")raw.atk=convertStat(s.base_stat);else if(s.stat.name==="defense")raw.def=convertStat(s.base_stat);else if(s.stat.name==="hp")raw.hp=convertStat(s.base_stat);});return raw;}
+function autoDistribute(base,points){const gains=Object.fromEntries(STAT_KEYS.map((k)=>[k,0]));const ranking=[...STAT_KEYS].sort((a,b)=>base[b]-base[a]||STAT_KEYS.indexOf(a)-STAT_KEYS.indexOf(b));for(let i=0;i<points;i++)gains[ranking[i%ranking.length]]+=1;return gains;}
+function getAllocatedStats(base){const points=Number($("levelInput").value||1),gains=Object.fromEntries(STAT_KEYS.map((k)=>[k,0]));if(state.mode==="wild"||state.mode==="quick")Object.assign(gains,autoDistribute(base,points));if(state.mode==="trained")STAT_KEYS.forEach((k)=>gains[k]=Number($(`alloc-${k}`)?.value||0));if(state.mode==="wild"&&isAlpha()){const top=[...STAT_KEYS].sort((a,b)=>base[b]-base[a]).slice(0,2);gains[top[0]]+=5;gains[top[1]]+=5;}return {gains,points};}
+function ensureTrainedInputs(points){const list=$("levelStatsList");if(state.mode!=="trained")return;if(list.querySelector("input"))return;list.innerHTML="";STAT_KEYS.forEach((k)=>{const li=document.createElement("li");li.innerHTML=`${STAT_LABELS[k]}: <input class="alloc-input" id="alloc-${k}" type="number" min="0" max="${points}" value="0">`;list.appendChild(li);});list.querySelectorAll("input").forEach((i)=>i.addEventListener("input",renderSheet));}
+
+function renderSheet(){if(!state.pokemon)return;const base=getBaseStats();const {gains,points}=getAllocatedStats(base);ensureTrainedInputs(points);const nature=getNature();const finalStats=Object.fromEntries(STAT_KEYS.map((k)=>[k,base[k]+gains[k]]));if(nature.plus)finalStats[nature.plus]+=2;if(nature.minus)finalStats[nature.minus]-=2;const sprite = isShiny() ? (state.pokemon.sprites.other["official-artwork"].front_shiny||state.pokemon.sprites.front_shiny) : (state.pokemon.sprites.other["official-artwork"].front_default||state.pokemon.sprites.front_default);
+$("sheetSprite").src=sprite;$("sheetName").textContent=(state.mode==="trained"&&$("nicknameInput").value.trim())?`${$("nicknameInput").value.trim()} (${formatName(state.pokemon.name)})`:formatName(state.pokemon.name);$("sheetMeta").textContent=`Nv ${points} • ${selectedGender()} • Nature: ${nature.pt}`;$("sheetModeLabel").textContent=`Modo: ${state.mode}`;renderLoyalty();renderBasicsInfo();renderCapacities(finalStats, points);
+$("baseStatsList").innerHTML=STAT_KEYS.map((k)=>`<li>${STAT_LABELS[k]}: <strong>${base[k]}</strong></li>`).join("");if(state.mode!=="trained")$("levelStatsList").innerHTML=STAT_KEYS.map((k)=>`<li>${STAT_LABELS[k]}: +${gains[k]}</li>`).join("");$("finalStatsList").innerHTML=STAT_KEYS.map((k)=>`<li class="${nature.plus===k?"stat-positive":nature.minus===k?"stat-negative":""}">${STAT_LABELS[k]}: <strong>${finalStats[k]}</strong></li>`).join("");
+const hp1=(finalStats.hp+points)*4,hp2=points+finalStats.hp*3;$("hp1Text").textContent=`${hp1} / ${hp1}`;$("hp2Text").textContent=`${hp2} / ${hp2}`;$("natureTaste").innerHTML=`<strong>${nature.pt}</strong><br><span class="nature-pill">Gosta de:</span> ${nature.taste.includes("Neutra")?"Neutra":""}${nature.taste.includes("Gosta de")?nature.taste.split(" e não gosta de ")[0].replace("Gosta de ",""):""}<br><span class="nature-pill">Não gosta de:</span> ${nature.taste.includes("não gosta de")?nature.taste.split("não gosta de ")[1]:"Neutra"}`;renderRadars(finalStats);}
+function renderBasicsInfo(){const types=state.pokemon.types.map((t)=>t.type.name);$("sheetTypes").innerHTML=types.map((t)=>`<img src="assets/types/${t}.png" alt="${t}">`).join("");$("sheetSize").textContent=`${(state.pokemon.height/10).toFixed(1)} m • ${(state.pokemon.weight/10).toFixed(1)} kg`;$("sheetEggGroups").textContent=state.species.egg_groups.map((g)=>formatName(g.name)).join(" | ");}
+async function renderDamageRelations(){if(!state.pokemon)return;const types=state.pokemon.types.map((t)=>t.type.name);const rel={};const apply=(arr,m)=>arr.forEach((t)=>rel[t.name]=(rel[t.name]??1)*m);const t1=await fetch(`https://pokeapi.co/api/v2/type/${types[0]}`).then((r)=>r.json());apply(t1.damage_relations.double_damage_from,2);apply(t1.damage_relations.half_damage_from,.5);apply(t1.damage_relations.no_damage_from,0);if(types[1]){const t2=await fetch(`https://pokeapi.co/api/v2/type/${types[1]}`).then((r)=>r.json());apply(t2.damage_relations.double_damage_from,2);apply(t2.damage_relations.half_damage_from,.5);apply(t2.damage_relations.no_damage_from,0);}const weak=[],res=[],imm=[];Object.entries(rel).forEach(([t,v])=>{if(v===0)imm.push(t);else if(v>1)weak.push(t);else if(v<1)res.push(t);});$("weaknesses").innerHTML=weak.map((t)=>`<img src="assets/types/${t}.png" title="${t}">`).join("");$("resistances").innerHTML=res.map((t)=>`<img src="assets/types/${t}.png" title="${t}">`).join("");$("immunities").innerHTML=imm.map((t)=>`<img src="assets/types/${t}.png" title="${t}">`).join("");}
+function renderLoyalty(){const val=Math.max(0,Math.min(4,Number($("loyaltyInput")?.value||0)));const txt=["O pokemon não confia em você","O pokemon vê algo em você","O pokemon se preocupa com você","O pokemon gosta bastante de você","O pokemon ama você"][val];$("sheetLoyalty").innerHTML=state.mode==="trained"?`${txt} ${val>0?`<img src="assets/icons/lealdade${val}.png" alt="Lealdade ${val}" width="20">`:""}`:"";}
+function renderCapacities(finalStats, level){const int=Math.max(0,Math.floor((finalStats.spatk+finalStats.spdef)/6));const str=Math.max(0,Math.floor((finalStats.atk+finalStats.def)/6));const mov=Math.max(1,Math.floor((finalStats.spd+level)/6));$("cap-int").textContent=int;$("cap-str").textContent=str;$("cap-mov").textContent=mov;$("cap-int-label").textContent=capLabel(int,["Instintivo","Observador","Sagaz","Brilhante","Gênio"]);$("cap-str-label").textContent=capLabel(str,["Frágil","Subdesenvolvida","Treinada","Potente","Colossal"]);$("cap-mov-label").textContent=capLabel(mov,["Lento","Ágil","Veloz","Relâmpago","Supersônico"]);}
+function contestValue(v){if(v<=3)return 1;if(v<=6)return 2;if(v<=9)return 3;if(v<=12)return 4;return 5;}
+function renderRadars(finalStats){if(typeof Chart==="undefined")return;state.statsChart?.destroy();state.contestChart?.destroy();state.statsChart=new Chart($("statsRadar"),{type:"radar",data:{labels:["HP","ATK","DEF","Sp.ATK","Sp.DEF","SPD"],datasets:[{data:[finalStats.hp,finalStats.atk,finalStats.def,finalStats.spatk,finalStats.spdef,finalStats.spd],backgroundColor:"rgba(123,220,101,.2)",borderColor:"#7bdc65",pointRadius:0}]},options:{plugins:{legend:{display:false}},scales:{r:{ticks:{display:false}}}}});const contest=[contestValue(finalStats.spatk),contestValue(finalStats.spd),contestValue(finalStats.atk),contestValue(finalStats.spdef),contestValue(finalStats.def)];state.contestChart=new Chart($("contestRadar"),{type:"radar",data:{labels:["Beleza","Fofura","Estilo","Inteligência","Vigor"],datasets:[{data:contest,backgroundColor:"rgba(255,105,180,.25)",borderColor:"#ff69b4",pointRadius:0}]},options:{plugins:{legend:{display:false}},scales:{r:{ticks:{display:false}}}}});}
+
+function openAbilitiesModal(){const modal=$("abilitiesModal"),body=$("abilitiesModalBody"),limit=Number($("levelInput").value||1)>=40?2:1;body.innerHTML="";state.pokemon.abilities.forEach((a)=>{const info=abilitiesData[a.ability.name]||{name:formatName(a.ability.name),ptName:formatName(a.ability.name),activation:"—",effect:"—"};const div=document.createElement("div");div.className="ability-option";div.innerHTML=`<strong>${info.name} = ${info.ptName}</strong><br>Ativação: ${info.activation}<br>Efeito: ${info.effect}`;const btns=document.createElement("div");btns.className="ability-buttons";btns.innerHTML=`<button type="button">Selecionar slot 1</button>${limit>1?'<button type="button">Selecionar slot 2</button>':''}`;btns.children[0].onclick=()=>{state.abilitySlots[0]=a.ability.name;renderAbilitySummary();};if(limit>1&&btns.children[1])btns.children[1].onclick=()=>{state.abilitySlots[1]=a.ability.name;renderAbilitySummary();};div.appendChild(btns);body.appendChild(div);});modal.showModal();}
+function renderAbilitySummary(){const limit=Number($("levelInput").value||1)>=40?2:1;$("abilitiesSummary").textContent=[state.abilitySlots[0],limit>1?state.abilitySlots[1]:null].filter(Boolean).map(formatName).join(" • ")||"Sem habilidade";}
+async function openMoveModal(moveName){const entry=state.levelMoves.find((m)=>m.name===moveName)||state.tmMoves.find((m)=>m.name===moveName);if(!entry)return;const m=await getMove(entry.url);const level=Number($("levelInput").value||1);const stab=state.pokemon.types.some((t)=>t.type.name===m.type.name)&&m.power?Math.floor(level/5):0;const dmg=m.power?`${powerToDamage(m.power)}${stab?` + ${stab}`:""}`:"—";$("moveModalTitle").textContent=formatName(moveName);$("moveDetailsBody").innerHTML=`<p><img src="assets/types/${m.type.name}.png" width="22"> ${formatName(m.type.name)} • ${formatName(m.damage_class.name)}</p><p>Dano RPG: <strong>${dmg}</strong></p><p>Acerto: ${m.accuracy ?? "—"} • PP: ${m.pp ?? "—"}</p><p>${m.effect_entries.find((e)=>e.language.name==='en')?.short_effect||'Sem descrição.'}</p>`;$("moveDetailsModal").showModal();}
+
+function setupQuickGeneration(){$("quickGenerateBtn").addEventListener("click",async()=>{if(!state.pokemonIndex.length)return;const random=state.pokemonIndex[Math.floor(Math.random()*state.pokemonIndex.length)];await loadSpecies(String(random.id));$("levelInput").value=Math.floor(Math.random()*100)+1;$("natureSelect").value=NATURES[Math.floor(Math.random()*NATURES.length)].name;renderMoveOptions();state.selectedLevelMoves=state.levelMoves.filter((m)=>m.level<=Number($("levelInput").value)).slice(-4).map((m)=>m.name);state.selectedTmMoves=state.tmMoves.slice(0,4).map((m)=>m.name);await renderSelectedMoves();renderSheet();});}
+function getSheetPayload(){const base=getBaseStats();const {gains,points}=getAllocatedStats(base);const nature=getNature();return {mode:state.mode,pokemon:state.pokemon.name,level:points,shiny:isShiny(),gender:selectedGender(),abilities:state.abilitySlots.filter(Boolean),nickname:$("nicknameInput")?.value||"",loyalty:Number($("loyaltyInput")?.value||0),alpha:isAlpha(),nature,base,gains,moves:{level:[...state.selectedLevelMoves],tm:[...state.selectedTmMoves]}};}
+function setupExport(){$("copySheetBtn").addEventListener("click",async()=>{const p=getSheetPayload();await navigator.clipboard.writeText(`[${formatName(p.pokemon)}] Nv.${p.level} (${p.mode})\nNature: ${p.nature.pt}\nHabilidades: ${p.abilities.map(formatName).join(", ")}`);notify("Ficha copiada!");});$("copyMovesBtn").addEventListener("click",async()=>{const p=getSheetPayload();await navigator.clipboard.writeText([...p.moves.level,...p.moves.tm].map((m)=>`- ${formatName(m)}`).join("\n"));notify("Golpes copiados!");});$("saveJsonBtn").addEventListener("click",()=>{const p=getSheetPayload();const blob=new Blob([JSON.stringify(p,null,2)],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`${p.pokemon}-ficha.json`;a.click();URL.revokeObjectURL(url);});}
+function setupGeneralEvents(){document.querySelectorAll("[data-close-modal]").forEach((b)=>b.addEventListener("click",()=>$(b.dataset.closeModal).close()));$("addLevelMoveBtn").type="button";$("sheetCryBtn").addEventListener("click",()=>{const src=state.pokemon?.cries?.latest; if(!src)return; new Audio(src).play();});}
+
+async function init(){setupMenu();setupModes();setupMobileTabs();setupSearch();setupMoveActions();setupQuickGeneration();setupExport();setupGeneralEvents();await fetchPokemonIndex();}
 init();
